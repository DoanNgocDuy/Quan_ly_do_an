<!DOCTYPE html>
{% load static %}
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="{% static 'css/main.css' %}">
    <title>ƒê·ªì √Ån ƒê√£ ƒêƒÉng K√Ω</title>
   
</head>
<body>
    <div class="container do-an-da-dang-ky-page">
        <h1 class="title">ƒê·ªì √Ån ƒê√£ ƒêƒÉng K√Ω</h1>

        {% if messages %}
            {% for message in messages %}
                <div class="
                    {% if 'error' in message.tags %}
                        error-message 
                    {% elif 'success' in message.tags %}
                        success-message
                    {% else %}
                        {{ message.tags }}
                    {% endif %}
                ">
                    {{ message }}
                </div>
            {% endfor %}
        {% endif %}
        <br>

        {% if do_an_da_dang_ky %}
            {% for dang_ky in do_an_da_dang_ky %}
                <div class="do-an">
                    <h2>{{ dang_ky.DoAn.Ma_do_an }} - {{ dang_ky.DoAn.Ten_do_an }}</h2>
                    <p>M√¥ t·∫£: {{ dang_ky.DoAn.Mo_ta }}</p>
                    <p>Khoa: {{ dang_ky.DoAn.Khoa.Tenkhoa }}</p>
                    <p>Gi·∫£ng vi√™n h∆∞·ªõng d·∫´n: {{ dang_ky.DoAn.GiangVien.Tengv }}</p>
                    <p>Email: {{ dang_ky.DoAn.GiangVien.Email }}</p>
                    <p>S·ªë ƒëi·ªán tho·∫°i: {{ dang_ky.DoAn.GiangVien.So_dien_thoai }}</p>

                    <div class="gv-nhan-xet">
                        <strong>Nh·∫≠n x√©t t·ª´ Gi·∫£ng vi√™n ({{ dang_ky.DoAn.GiangVien.Tengv }}):</strong>
                        {% if dang_ky.nhan_xet_gv %}
                            <p>{{ dang_ky.nhan_xet_gv }}</p>
                        {% else %}
                            <p style="color: #6c757d;">(Ch∆∞a c√≥ nh·∫≠n x√©t n√†o ƒë∆∞·ª£c g·ª≠i.)</p>
                        {% endif %}
                    </div>
                    <form method="POST" style="display:inline;">
                        {% csrf_token %}
                        <input type="hidden" name="action" value="huy">
                        <input type="hidden" name="do_an_id" value="{{ dang_ky.DoAn.id }}">
                        <button type="submit">H·ªßy ƒëƒÉng k√Ω</button>
                    </form>
                    
                    <hr> 
                    
                    <h3>N·ªôp File ƒê·ªì √Ån üíæ</h3>
                <form method="POST" enctype="multipart/form-data" style="margin-top: 10px;">
                    {% csrf_token %}
                    
                    <input type="hidden" name="action" value="nop_file">
                    <input type="hidden" name="dang_ky_id" value="{{ dang_ky.id }}"> 
                    
                    <label for="id_file">File:</label>
                    <input type="file" name="file" id="id_file" required> 
                    
                    <br><br>

                    <label for="id_mo_ta_file">M√¥ t·∫£ file:</label>
                    <input type="text" name="mo_ta_file" id="id_mo_ta_file" maxlength="100"> 
                    
                    <br><br>
                    
                    <button type="submit">N·ªôp File </button>
                </form>
                    <h3 style="margin-top: 15px;">Files ƒë√£ n·ªôp:</h3>
                    <ul>
                        {% for f in dang_ky.files_nop.all %} 
                            <li>
                                <strong>{{ f.mo_ta_file|default:"(Kh√¥ng m√¥ t·∫£)" }}</strong>: 
                                <a href="{{ f.file.url }}" target="_blank">
                                    {{ f.file.name|slice:"-30:" }} 
                                </a>
                                (N·ªôp l√∫c: {{ f.uploaded_at|date:"d/m/Y H:i" }})

                                <form method="POST" action="{% url 'file_delete' f.id %}" style="display:inline; margin-left: 10px;">
                                    {% csrf_token %}
                                    <button type="submit" 
                                                    class="action-btn delete-btn" 
                                                    onclick="return confirm('B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a file {{ f.file.name|slice:"-20:" }}?');"
                                                    style="color: red; background: none; border: none; cursor: pointer;">
                                        [X√≥a]
                                    </button>
                                </form>
                                </li>
                        {% empty %}
                            <li>Ch∆∞a n·ªôp file n√†o.</li>
                        {% endfor %}
                    </ul>
                </div>
                <hr>
            {% endfor %}
        {% else %}
            <p>Ch∆∞a ƒëƒÉng k√Ω ƒë·ªì √°n n√†o.</p>
        {% endif %}

        <br>
        <a class="back-link" href="{% url 'danh_sach_do_an' %}">Quay l·∫°i danh s√°ch ƒë·ªì √°n</a>
    </div>
</body>
</html>