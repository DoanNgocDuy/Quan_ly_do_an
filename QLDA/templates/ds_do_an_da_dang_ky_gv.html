<!DOCTYPE html>
{% load static %}
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="{% static 'css/main.css' %}">
    <title>Danh S√°ch ƒê·ªì √Ån Sinh Vi√™n ƒêƒÉng K√Ω</title>
    
    <style>
        /* CSS n·ªôi b·ªô ƒë·ªÉ ƒë·ªãnh d·∫°ng danh s√°ch file n·∫øu c·∫ßn */
        .file-list {
            list-style: none; 
            padding: 0; 
            margin: 0;
            text-align: left;
            font-size: 0.9em;
        }
        .file-list li {
            margin-bottom: 5px;
            white-space: nowrap; 
            overflow: hidden;
            text-overflow: ellipsis; 
        }
        /* Style cho textarea v√† button */
        .nhan-xet-form textarea {
            width: 100%;
            box-sizing: border-box;
            resize: vertical;
            font-size: 0.9em;
            padding: 4px;
        }
        .nhan-xet-form button {
            background-color: #4CAF50;
            color: white;
            border: none;
            padding: 5px 10px;
            cursor: pointer;
            float: right;
            margin-top: 5px;
        }
        /* ƒê·∫£m b·∫£o c·ªôt hi·ªÉn th·ªã nh·∫≠n x√©t tƒ©nh c√≥ k√≠ch th∆∞·ªõc ph√π h·ª£p */
        .nhan-xet-display {
            min-width: 200px;
            max-width: 300px;
            overflow-y: auto; /* Th√™m thanh cu·ªôn n·∫øu nh·∫≠n x√©t qu√° d√†i */
            font-size: 0.9em;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="title">Danh S√°ch ƒê·ªì √Ån Sinh Vi√™n ƒêƒÉng K√Ω</h1>
        <h2>Gi·∫£ng vi√™n: {{ giang_vien.Tengv }}</h2>

        {% if messages %}
            {% for message in messages %}
                <div style="padding: 10px; margin-bottom: 10px; border: 1px solid {% if 'success' in message.tags %}green{% else %}red{% endif %}; background-color: {% if 'success' in message.tags %}#e6ffe6{% else %}#ffe6e6{% endif %};">
                    {{ message }}
                </div>
            {% endfor %}
        {% endif %}

        {% if ds_dang_ky %}
            <table border="1" cellpadding="5" cellspacing="0" style="width: 100%; text-align: left;">
                <thead>
                    <tr>
                        <th>M√£ ƒê·ªì √Ån</th>
                        <th>T√™n ƒê·ªì √Ån</th>
                        <th>M√£ Sinh Vi√™n</th>
                        <th>T√™n Sinh Vi√™n</th>
                        <th>Email</th>
                        <th>S·ªë ƒêi·ªán Tho·∫°i</th>
                        <th>Files ƒê√£ N·ªôp</th> 
                        <th>Nh·∫≠n X√©t ƒê√£ L∆∞u</th> 
                        <th>C·∫≠p Nh·∫≠t Nh·∫≠n X√©t</th> 
                    </tr>
                </thead>
                <tbody>
                    {% for dk in ds_dang_ky %}
                        <tr>
                            <td>{{ dk.DoAn.Ma_do_an }}</td>
                            <td>{{ dk.DoAn.Ten_do_an }}</td>
                            <td>{{ dk.SinhVien.Msv }}</td>
                            <td>{{ dk.SinhVien.Tensv }}</td>
                            <td>{{ dk.SinhVien.Email }}</td>
                            <td>{{ dk.SinhVien.So_dien_thoai }}</td>
                            
                            <td>
                                {% if dk.files_nop.all %}
                                    <ul class="file-list">
                                        {% for file in dk.files_nop.all %}
                                            <li>
                                                <a href="{{ file.file.url }}" 
                                                   target="_blank" 
                                                   title="{{ file.mo_ta_file|default:"Kh√¥ng m√¥ t·∫£" }}">
                                                    
                                                    üíæ {{ file.file.name|slice:"-30:" }} 
                                                </a> 
                                                <br>
                                                <small>({{ file.uploaded_at|date:"d/m H:i" }})</small>
                                            </li>
                                        {% endfor %}
                                    </ul>
                                {% else %}
                                    Ch∆∞a n·ªôp file n√†o
                                {% endif %}
                            </td>
                            
                            <td class="nhan-xet-display">
    {% if dk.nhan_xet_gv %}
        <span style="color: darkgreen; display: block; white-space: pre-wrap;">{{ dk.nhan_xet_gv }}</span>
    {% else %}
        <span style="color: #666; font-style: italic;">Ch∆∞a c√≥ nh·∫≠n x√©t.</span>
    {% endif %}
</td>

<td class="nhan-xet-form" style="min-width: 220px;">
    <form method="POST" style="margin: 0;">
        {% csrf_token %}
        <input type="hidden" name="action" value="luu_nhan_xet_nhanh">
        <input type="hidden" name="dang_ky_id" value="{{ dk.id }}">
        
        <textarea name="nhan_xet" 
                  rows="3" 
                  placeholder="Nh·∫≠p nh·∫≠n x√©t m·ªõi..."></textarea>
               
        <button type="submit">G·ª≠i</button>
        <div style="clear: both;"></div>
    </form>
</td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        {% else %}
            <p>Ch∆∞a c√≥ sinh vi√™n n√†o ƒëƒÉng k√Ω ƒë·ªì √°n c·ªßa b·∫°n.</p>
        {% endif %}

        <br>
        <a class="back-link" href="{% url 'danh_sach_do_an' %}">Quay l·∫°i danh s√°ch ƒë·ªì √°n</a>
    </div>
</body>
</html>